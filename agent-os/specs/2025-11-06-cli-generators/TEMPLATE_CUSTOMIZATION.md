# Template Customization Guide

Learn how to customize Fuse CLI generator templates to match your team's coding standards and conventions.

## Table of Contents

- [Overview](#overview)
- [Template Search Path](#template-search-path)
- [Available Templates](#available-templates)
- [Template Variables](#template-variables)
- [Customization Examples](#customization-examples)
- [Best Practices](#best-practices)

---

## Overview

Fuse CLI generators use template files to generate code. You can override default templates by creating custom versions in your application's `config/templates/` directory.

### Why Customize Templates?

- Enforce team coding standards
- Add custom JSDoc comments
- Include company-specific headers
- Pre-populate common patterns
- Integrate with custom base classes

---

## Template Search Path

When generating files, the CLI searches for templates in this order:

1. **Application Templates** - `config/templates/` (your custom templates)
2. **Framework Templates** - `fuse/cli/templates/` (default templates)

**Example:**

```
your-app/
├── config/
│   └── templates/
│       └── model.cfc.tmpl      ← Used if exists
└── fuse/
    └── cli/
        └── templates/
            └── model.cfc.tmpl  ← Default fallback
```

This allows you to override any template without modifying the framework.

---

## Available Templates

### Generator Templates

| Template File | Used By | Purpose |
|---------------|---------|---------|
| `model.cfc.tmpl` | Model Generator | ActiveRecord model |
| `create_migration.cfc.tmpl` | Model/Migration Generator | Create table migration |
| `alter_migration.cfc.tmpl` | Migration Generator | Alter table migration |
| `handler.cfc.tmpl` | Handler Generator | Full RESTful handler |
| `handler_api.cfc.tmpl` | Handler Generator (--api) | API-only handler |

### Application Scaffold Templates

| Template File | Used By | Purpose |
|---------------|---------|---------|
| `Application.cfc.tmpl` | New Command | Application.cfc |
| `routes.cfc.tmpl` | New Command | Routes configuration |
| `database.cfc.tmpl` | New Command | Database configuration |
| `README.md.tmpl` | New Command | Project README |
| `.gitignore.tmpl` | New Command | Git ignore file |
| `box.json.tmpl` | New Command | CommandBox package file |

---

## Template Variables

Templates use `{{variableName}}` syntax for interpolation.

### Model Template Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `{{componentName}}` | Pascal-cased model name | `User`, `BlogPost` |
| `{{tableName}}` | Plural snake-case table name | `users`, `blog_posts` |
| `{{relationships}}` | Generated relationship comments | `// belongsTo: User` |
| `{{validations}}` | Placeholder for validations | `// Add validations` |

### Migration Template Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `{{migrationName}}` | Migration class name | `CreateUsers`, `AddEmailToUsers` |
| `{{tableName}}` | Table name | `users`, `posts` |
| `{{columns}}` | Column definitions | `table.string("name")` |
| `{{timestamp}}` | Migration timestamp | `20251106123045` |

### Handler Template Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `{{handlerName}}` | Handler component name | `Users`, `Products` |
| `{{namespace}}` | Handler namespace path | `Api.V1` |
| `{{actions}}` | Generated action methods | Full method definitions |

### Application Template Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `{{appName}}` | Application name | `my-blog-app` |
| `{{datasourceName}}` | Datasource name | `my-blog-app` |
| `{{databaseType}}` | Database type | `mysql`, `postgresql` |
| `{{year}}` | Current year | `2025` |

---

## Customization Examples

### Example 1: Custom Model Template

Add company copyright header and custom init structure.

**File:** `config/templates/model.cfc.tmpl`

```cfml
/**
 * {{componentName}} Model
 *
 * @copyright MyCompany (c) {{year}}
 * @author Generated by Fuse CLI
 */
component extends="fuse.orm.ActiveRecord" accessors="true" {

    /**
     * Initialize model
     */
    function init() {
        super.init();

        // Configure table (optional override)
        // this.tableName = "{{tableName}}";

        {{relationships}}

        {{validations}}

        // Add lifecycle callbacks here
        // this.beforeSave = "validateData";

        return this;
    }

    /**
     * Custom validation method
     */
    private boolean function validateData() {
        // Add custom validation logic
        return true;
    }

}
```

**Usage:**

```bash
lucli generate model Product name:string price:decimal
```

**Generated:** `app/models/Product.cfc`

```cfml
/**
 * Product Model
 *
 * @copyright MyCompany (c) 2025
 * @author Generated by Fuse CLI
 */
component extends="fuse.orm.ActiveRecord" accessors="true" {

    /**
     * Initialize model
     */
    function init() {
        super.init();

        // Configure table (optional override)
        // this.tableName = "products";

        // Define relationships here

        // Define validations here

        // Add lifecycle callbacks here
        // this.beforeSave = "validateData";

        return this;
    }

    /**
     * Custom validation method
     */
    private boolean function validateData() {
        // Add custom validation logic
        return true;
    }

}
```

---

### Example 2: Custom Handler with Logging

Add logging to all handler actions.

**File:** `config/templates/handler.cfc.tmpl`

```cfml
/**
 * {{handlerName}} Handler
 *
 * RESTful controller for {{handlerName}} resource
 */
component {

    property name="logger" inject="LogService";

    /**
     * List all {{handlerName}}
     * @route GET /{{tableName}}
     */
    function index() {
        logger.info("{{handlerName}}.index called");

        return {
            data: [],
            message: "List all {{handlerName}}"
        };
    }

    /**
     * Show single {{handlerName}}
     * @route GET /{{tableName}}/:id
     */
    function show(required numeric id) {
        logger.info("{{handlerName}}.show called", {id: arguments.id});

        return {
            data: {},
            message: "Show {{handlerName}} ##arguments.id##"
        };
    }

    /**
     * Display form for new {{handlerName}}
     * @route GET /{{tableName}}/new
     */
    function new() {
        logger.info("{{handlerName}}.new called");
        return "{{tableName}}/new";
    }

    /**
     * Create new {{handlerName}}
     * @route POST /{{tableName}}
     */
    function create() {
        logger.info("{{handlerName}}.create called");

        return {
            success: true,
            message: "{{handlerName}} created"
        };
    }

    /**
     * Display form to edit {{handlerName}}
     * @route GET /{{tableName}}/:id/edit
     */
    function edit(required numeric id) {
        logger.info("{{handlerName}}.edit called", {id: arguments.id});
        return "{{tableName}}/edit";
    }

    /**
     * Update {{handlerName}}
     * @route PUT /{{tableName}}/:id
     */
    function update(required numeric id) {
        logger.info("{{handlerName}}.update called", {id: arguments.id});

        return {
            success: true,
            message: "{{handlerName}} updated"
        };
    }

    /**
     * Delete {{handlerName}}
     * @route DELETE /{{tableName}}/:id
     */
    function destroy(required numeric id) {
        logger.info("{{handlerName}}.destroy called", {id: arguments.id});

        return {
            success: true,
            message: "{{handlerName}} deleted"
        };
    }

}
```

---

### Example 3: Custom Migration with Comments

Add detailed comments to migrations.

**File:** `config/templates/create_migration.cfc.tmpl`

```cfml
/**
 * {{migrationName}}
 *
 * Created: {{date}}
 * Purpose: Create {{tableName}} table
 */
component extends="fuse.orm.Migration" {

    /**
     * Run the migration
     */
    function up() {
        var schema = getSchema();

        schema.create("{{tableName}}", function(table) {
            // Primary key
            table.id();

            // Table columns
            {{columns}}

            // Timestamps
            table.timestamps();

            // Indexes
            // Add custom indexes here if needed
        });
    }

    /**
     * Reverse the migration
     */
    function down() {
        var schema = getSchema();
        schema.drop("{{tableName}}");
    }

}
```

---

### Example 4: API Handler with Error Handling

**File:** `config/templates/handler_api.cfc.tmpl`

```cfml
/**
 * {{handlerName}} API Handler
 */
component {

    property name="{{componentName}}Service" inject;

    /**
     * List all {{handlerName}}
     * @route GET /api/{{tableName}}
     */
    function index() {
        try {
            var records = {{componentName}}Service.getAll();

            return {
                success: true,
                data: records,
                count: arrayLen(records)
            };
        } catch (any e) {
            return {
                success: false,
                error: e.message,
                code: 500
            };
        }
    }

    /**
     * Show single {{handlerName}}
     * @route GET /api/{{tableName}}/:id
     */
    function show(required numeric id) {
        try {
            var record = {{componentName}}Service.getById(arguments.id);

            return {
                success: true,
                data: record
            };
        } catch (any e) {
            return {
                success: false,
                error: e.message,
                code: 404
            };
        }
    }

    /**
     * Create new {{handlerName}}
     * @route POST /api/{{tableName}}
     */
    function create() {
        try {
            var record = {{componentName}}Service.create(form);

            return {
                success: true,
                data: record,
                code: 201
            };
        } catch (any e) {
            return {
                success: false,
                error: e.message,
                code: 400
            };
        }
    }

    /**
     * Update {{handlerName}}
     * @route PUT /api/{{tableName}}/:id
     */
    function update(required numeric id) {
        try {
            var record = {{componentName}}Service.update(arguments.id, form);

            return {
                success: true,
                data: record
            };
        } catch (any e) {
            return {
                success: false,
                error: e.message,
                code: 400
            };
        }
    }

    /**
     * Delete {{handlerName}}
     * @route DELETE /api/{{tableName}}/:id
     */
    function destroy(required numeric id) {
        try {
            {{componentName}}Service.delete(arguments.id);

            return {
                success: true,
                code: 204
            };
        } catch (any e) {
            return {
                success: false,
                error: e.message,
                code: 400
            };
        }
    }

}
```

---

## Best Practices

### 1. Start with Default Templates

Copy the default template before customizing:

```bash
# Create templates directory
mkdir -p config/templates

# Copy default template
cp fuse/cli/templates/model.cfc.tmpl config/templates/model.cfc.tmpl

# Edit your copy
vim config/templates/model.cfc.tmpl
```

### 2. Preserve Variable Placeholders

Always keep the `{{variableName}}` placeholders:

```cfml
# Good
component extends="fuse.orm.ActiveRecord" {
    // Table: {{tableName}}
}

# Bad - missing variable
component extends="fuse.orm.ActiveRecord" {
    // Table: users  ← Hardcoded!
}
```

### 3. Test Custom Templates

Generate a component and verify the output:

```bash
# Test model template
lucli generate model TestModel name:string

# Check generated file
cat app/models/TestModel.cfc

# Delete test if good
rm app/models/TestModel.cfc
```

### 4. Version Control Templates

Commit custom templates to your repository:

```bash
git add config/templates/
git commit -m "Add custom generator templates"
```

### 5. Document Custom Variables

If you add custom logic or variables, document them:

```cfml
/**
 * Custom Model Template
 *
 * Variables:
 * - {{componentName}} - Model name (PascalCase)
 * - {{tableName}} - Table name (snake_case)
 * - {{relationships}} - Relationship comments
 * - {{year}} - Current year (custom)
 */
```

### 6. Keep Templates Synchronized

When updating Fuse, review framework template changes:

```bash
# Check for framework template updates
diff config/templates/model.cfc.tmpl fuse/cli/templates/model.cfc.tmpl

# Merge important changes to your custom template
```

### 7. Use Consistent Formatting

Match your team's style guide:

```cfml
# Tab indentation
component {
	function init() {
		return this;
	}
}

# Vs. space indentation
component {
    function init() {
        return this;
    }
}
```

---

## Template Debugging

### Verify Template is Being Used

The generator will use your custom template if it exists:

```bash
# Check which template will be used
ls -la config/templates/model.cfc.tmpl

# Generate and verify
lucli generate model Test name:string
cat app/models/Test.cfc
```

### Common Issues

#### Template Not Being Used

**Problem:** Custom template exists but default is still used.

**Solutions:**
1. Check filename exactly matches (e.g., `model.cfc.tmpl` not `Model.cfc.tmpl`)
2. Ensure file is in `config/templates/` directory
3. Verify file has correct permissions

#### Syntax Errors in Generated Code

**Problem:** Generated code has CFML syntax errors.

**Solutions:**
1. Check template CFML syntax is valid
2. Verify variable placeholders are properly escaped
3. Test template with simple generation first

#### Missing Variables

**Problem:** `{{variableName}}` appears literally in generated code.

**Solutions:**
1. Check variable name spelling
2. Verify variable is supported for that template type
3. Ensure double braces `{{` and `}}` are used

---

## Advanced Customization

### Conditional Content

Templates don't support complex logic, but you can add commented placeholders:

```cfml
component extends="fuse.orm.ActiveRecord" {
    function init() {
        super.init();

        {{relationships}}

        // TODO: Add custom scopes here
        // this.addScope("active", function(query) {
        //     return query.where("status", "=", "active");
        // });

        return this;
    }
}
```

### Team-Specific Patterns

Include common patterns your team uses:

```cfml
component extends="fuse.orm.ActiveRecord" {
    function init() {
        super.init();

        // Standard validations template
        this.validates("name", {
            presence: true,
            length: {min: 3, max: 255}
        });

        return this;
    }

    // Standard search method
    public array function search(required string term) {
        return this.where("name", "LIKE", "%#arguments.term#%").get();
    }
}
```

---

## Next Steps

1. Review default templates in `fuse/cli/templates/`
2. Create `config/templates/` directory
3. Copy and customize templates for your needs
4. Test generated code thoroughly
5. Commit templates to version control
6. Share with your team

For more information, see [CLI Usage Guide](./CLI_USAGE.md).
